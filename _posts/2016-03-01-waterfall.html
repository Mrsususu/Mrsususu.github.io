---
layout: article
title:  "瀑布流布局再现"
date:   2016-03-01
author:  lishu
categories: 项目练习
---

<p>蘑菇街、花瓣网一些网站用的都是瀑布流式的布局，文本就尝试用js和jQuery分别实现这个布局。</p>
<!--brief-->

<h2>瀑布流需求</h2>
<p>具体分析来看，瀑布流实现主要依靠两个部分的功能实现。</p>
<p>需求一：第一行顺序排列，第二行第一个放在第一行最短的地方，第二个放在第一行次短的地方，依次排列。</p>
<p>需求二：最后一张图片A露出其高度一半后，开始加载A图片。</p>

<h2>实现思路（针对js而言）</h2>
<h3>需求一</h3>
<p>可以将图片分为两类，第一类是第一行按顺序排列，第二类是后续元素，获取前排元素中最短的位置排列上去。</p>
<p>这边考虑设置一个放置每列高度的数组，然后新元素添加到数组中值最小的那一列，随后更新数组，即可实现需求。</p>
<h3>需求二</h3>
<p>考虑最后一张图片的加载与否，借以判断的条件是满足<em>最后一张图片自身高度offsetHeight的一半加上其距顶端的实际距离offsetTop</em>比<em>页面可视区clientHeight加上滚动条已滚动的长度scrollTop</em>短，即可触发。</p>
<p>同时考虑到兼容性，以上几个偏移量的获取需要区分混杂模式（ie7之前版本）和标准模式。<em>混杂模式</em>下用document.body获取，<em>标准模式</em>下用document.documentElement获取。</p>
<p>另：后续图片的加载，本处采用模拟设置传入JSON格式的图片数据的方式。</p>

<h2>实现地址</h2>
<h3>js方案</h3>
<p><a href="/project/waterfall/js/waterfall.html" target="_blank">js实现瀑布流</a></p>
<h3>jQuery方案</h3>
<p><a href="/project/waterfall/jQuery/waterfall.html" target="_blank">jQuery实现瀑布流</a></p>

<h2>个人心得</h2>
<p>这个布局的实现主要是需要对页面的元素高度、相对偏移等的获取有清晰的了解。</p>
